<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Hospital Summary Generator - Comprehensive medical reporting system"
    />
    <title>Hospital Summary Generator</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      rel="icon"
      type="image/x-icon"
      href="{{ url_for('static', filename='fevicon.png') }}"
    />
    <style>
      /* CSS Variables for Theming */
      :root {
        --primary-color: #004e28;
        --secondary-color: #030434;
        --accent-color: #22c55e;
        --background-color: #dcb2776b;
        --text-color: #1e293b;
        --border-radius: 8px;
        --transition-speed: 0.3s;
        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
        --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      /* Reset and Base Styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Plus Jakarta Sans", sans-serif;
        background-color: var(--background-color);
        color: var(--text-color);
        line-height: 1.6;
        opacity: 0;
        animation: fadeIn 0.5s ease-in forwards;
      }

      /* Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes slideIn {
        from {
          transform: translateX(-100%);
        }
        to {
          transform: translateX(0);
        }
      }

      /* Layout Components */
      header {
        background: linear-gradient(
          to right,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
        padding: 1.5rem;
        box-shadow: var(--shadow-md);
        animation: slideIn 0.5s ease-out;
      }

      .container {
        max-width: 1400px;
        margin: 2rem auto;
        padding: 0 1rem;
      }

      /* Department Section Styles */
      .department-section {
        margin-bottom: 3rem;
        opacity: 0;
        transform: translateY(20px);
        animation: fadeIn 0.5s ease-out forwards;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      /* Table Styles */
      .table-container {
        background: antiquewhite;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-sm);
        margin-bottom: 2rem;
        overflow-x: auto;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        padding: 1rem;
        text-align: left;
        border: 1px solid #01180d;
        transition: background-color var(--transition-speed);
      }

      th {
        background-color: var(--primary-color);
        color: white;
        font-size: 15px;
        font-weight: 600;
        position: sticky;
        top: 0;
      }

      tr:hover td {
        background-color: #b3fab861;
      }

      .total-row {
        background-color: antiquewhite;
        font-weight: bold;
      }

      /* Navigation Tabs */
      .department-tabs {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
        overflow-x: auto;
        padding-bottom: 0.5rem;
      }

      .tab-button {
        padding: 0.75rem 1.5rem;
        background-color: rgb(253, 251, 248);
        border: none;
        border-radius: var(--border-radius);
        cursor: pointer;
        transition: all var(--transition-speed);
        white-space: nowrap;
      }

      .tab-button:hover,
      .tab-button.active {
        background-color: var(--primary-color);
        color: white;
      }

      /* Section Headers */
      .section-title {
        font-size: 1.5rem;
        color: var(--primary-color);
        margin-bottom: 1.5rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--accent-color);
      }

      .subsection-title {
        font-size: 1.25rem;
        color: var(--secondary-color);
        margin: 1rem 0;
      }

      /* Button Styles */
      .btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: var(--border-radius);
        cursor: pointer;
        transition: all var(--transition-speed);
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      .btn i {
        font-size: 1.1em;
      }

      /* Statistics Cards */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
      }

      .stat-card {
        background: white;
        padding: 1.5rem;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-sm);
        transition: transform var(--transition-speed);
      }

      .stat-card:hover {
        transform: translateY(-5px);
      }

      /* Footer */
      footer {
        background-color: var(--primary-color);
        color: white;
        padding: 2rem;
        text-align: center;
        margin-top: 4rem;
      }

      footer a {
        color: white;
        text-decoration: none;
        transition: opacity var(--transition-speed);
      }

      footer a:hover {
        opacity: 0.8;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .container {
          padding: 0 0.5rem;
        }

        th,
        td {
          padding: 0.75rem;
          font-size: 0.875rem;
        }

        .department-tabs {
          padding-bottom: 0.75rem;
        }

        .stat-card {
          padding: 1rem;
        }
      }

      .vis_button {
        padding: 0.75rem 1.5rem;
        background-color: var(--primary-color);
        border: none;
        border-radius: var(--border-radius);
        cursor: pointer;
        transition: all var(--transition-speed);
        white-space: nowrap;
        color: white;
        margin: 10px;
      }
      .hide {
        display: none;
      }
      .piechart {
        width: 250px;
        height: 250px;
        display: block;
        margin: 0 auto;
      }
     
    
   
    
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.4.0/purify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  </head>
  <body>
    <header>
      <h1>Hospital Summary Report {{date}}</h1>
    </header>

    <main class="container">
      <nav class="department-tabs">
        <button class="tab-button active">OPD</button>
        <button class="tab-button">IPD</button>
        <button class="tab-button">Doctors</button>
        <button class="tab-button">Laboratory (LIS)</button>
        <button class="tab-button">Operations (OT)</button>
        <button class="tab-button">RIS</button>
        <button class="tab-button">Biopsy</button>
        <button class="tab-button">Laboratory (LIS) Department Wise</button>
      </nav>

      <!-- OPD Section -->
      <section class="department-section" id="opd">
        <h2 class="section-title">OPD (Outpatient Department)</h2>

        <div class="table-container opdContainer">
          <h3 class="subsection-title">Department Wise Summary</h3>
          {{ summary_html_departments|safe }}
          <button class="vis_button" id="generate-dept-chart">
            Generate Visualization
          </button>
        </div>
        <canvas id="deptChart"></canvas>

        <div class="table-container opdCategoryContainer">
          <h3 class="subsection-title">Category Wise Summary</h3>
          {{ summary_html_categories|safe }}
          <button class="vis_button" id="generate-category-chart">
            Generate Visualization
          </button>
        </div>
        <canvas id="categoryChart" class="piechart"></canvas>
        <button id="opdDownload" class="btn">Download OPD Summary</button>
      </section>

       <!-- IPD Section -->
       <section class="department-section ipdSection" id="ipd">
        <h2 class="section-title">IPD (In patient Department)</h2>

        <div class="table-container ipdContainer">
          <h3 class="subsection-title">Department Wise Summary</h3>
          {{ tables[0]|safe }}
          <button class="vis_button" id="generate--chart-ipd">
            Generate Visualization
          </button>
        </div>

        <div class="vis-div">
          <!-- <h3>Chart: IPD 80% vs Total Count</h3> -->
          <canvas id="ipd-chart" style="width: 600px; height: 400px"></canvas>
        </div>
        <button id="ipdDownload" class="btn">Download IPD Summary</button>
      </section>

      <!-- Doctors Section -->
      <section class="department-section doctor-section" id="dr">
        <h2 class="section-title">Doctors Report</h2>

        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Sl.No</th>
                <th>Department</th>
                <th>Unit Wise Consulting Doctor</th>
                <th>IP Count</th>
              </tr>
            </thead>
            <tbody>
              {% for row in data_dr %}
              <tr>
                <td>{{ row['Sl.No'] }}</td>
                <td>{{ row['Department'] }}</td>
                <td>{{ row['Consulting Doctor'] }}</td>
                <td>{{ row['Total Count'] }}</td>
              </tr>
              {% endfor %}
              <tr class="total-row">
                <td colspan="3">Total</td>
                <td>{{ total_count_dr }}</td>
              </tr>
            </tbody>
          </table>
        </div>
        <button id="doctorDownload" class="btn">Download Doctors Summary</button>
      </section>

      <!-- LIS Section -->
      <section class="department-section" id="lis">
        <h2 class="section-title">Laboratory Information System (LIS)</h2>

        <div class="table-container lis-container">
          <table>
            <thead>
              <tr>
                <th>Sl. No</th>
                <th>Sub Department</th>
                <th>Services Required from OP</th>
                <th>OP Count</th>
                <th>Services Required from IP</th>
                <th>IP Count</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              {% for row in results_lis %}
              <tr {% if loop.last %}class="total-row" {% endif %}>
                <td>{{ row['sl_no'] }}</td>
                <td>{{ row['sub_department'] }}</td>
                <td>{{ row['blank1'] }}</td>
                <td>{{ row['op_count'] }}</td>
                <td>{{ row['blank2'] }}</td>
                <td>{{ row['ip_count'] }}</td>
                <td>{{ row['total_count'] }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          <button class="vis_button" id="generate--chart-lis">
            Generate Visualization
          </button>
        </div>
        <h3>Comparison of LIS Metrics</h3>

        <div class="lisOp">
          <h4>Chart 1: Services Required from OP vs. OP Count</h4>
          <canvas id="chart1" style="width: 600px; height: 400px"></canvas>
        </div>

        <div class="lisIp">
          <h4>Chart 2: Services Required from IP vs. IP Count</h4>
          <canvas id="chart2" style="width: 600px; height: 400px"></canvas>
        </div>

        <div class="table-container lis-category-container">
          <h3 class="subsection-title">Category Wise Summary</h3>
          {{ summary_html_categories_lis|safe }}
          <button class="vis_button" id="generate-category-chart-lis">
            Generate Visualization
          </button>
        </div>
        <div class="lis-category-vis">
        <h2>OPD Category Wise Data</h2>
        <canvas id="lisOpdCategoryChart" class="piechart"></canvas>
        <h2>IPD Category Wise Data</h2>
        <canvas id="lisIpdCategoryChart" class="piechart"></canvas>
        </div>
        <button id="lisDownload" class="btn">Download LIS Summary</button>
      </section>

      <!-- OT Section -->
      <section class="department-section" id="ot">
        <h2 class="section-title">Operations Report</h2>

        <div class="table-container minor-ot-container">
          <h3 class="subsection-title">Minor OT</h3>
          <table>
            <thead>
              <tr>
                <th>Sl. No</th>
                <th>Department Name</th>
                <th>Minor Surgeries Required</th>
                <th>Patient General</th>
                <th>General</th>
                <th>Aarogyasri</th>
                <th>ESH</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              {% for row in results_ot[1] %}
              <tr
                class="{% if row.department == 'Total' %}total-row{% endif %}"
              >
                <td>{{ row.sl_no }}</td>
                <td>{{ row.department }}</td>
                <td>{{ row.blank1 }}</td>
                <td>{{ row.minor_patient_general }}</td>
                <td>{{ row.minor_gen }}</td>
                <td>{{ row.minor_arg }}</td>
                <td>{{ row.minor_esh }}</td>
                <td>{{ row.minor_total }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
         <!-- Chart canvas for Minor OT -->
         <div>
          <canvas
            id="minorOtChart"
            
          ></canvas>
        </div>
        <div class="table-container major-ot-container">
          <h3 class="subsection-title">Major OT</h3>
          <table>
            <thead>
              <tr>
                <th>Sl. No</th>
                <th>Department Name</th>
                <th>Major Surgeries Required</th>
                <th>Patient General</th>
                <th>General</th>
                <th>Aarogyasri</th>
                <th>ESH</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              {% for row in results_ot[0] %}
              <tr
                class="{% if row.department == 'Total' %}total-row{% endif %}"
              >
                <td>{{ row.sl_no }}</td>
                <td>{{ row.department }}</td>
                <td>{{ row.blank2 }}</td>
                <td>{{ row.major_patient_general }}</td>
                <td>{{ row.major_gen }}</td>
                <td>{{ row.major_arg }}</td>
                <td>{{ row.major_esh }}</td>
                <td>{{ row.major_total }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <!-- Bar Chart Visualization for OT -->
        <h3>OT Operations Comparison</h3>
        <!-- Button to generate the OT comparison charts -->
        <button class="vis_button" id="generate-otChart" class="btn">
          Generate Visualization
        </button>

       

        <!-- Chart canvas for Major OT -->
        <div>
          <canvas
            id="majorOtChart"
            
          ></canvas>
        </div>
        <button id="otDownload" class="btn">Download OT Summary</button>
      </section>

      <!-- Ris Section -->
      <section class="department-section" id="ris">
        <div class="container">
          <h1>RIS Register Analysis Report</h1>

          <h2>Visit Type Analysis</h2>
          <table>
            <thead>
              <tr>
                <th>Sl.No</th>
                <th>Ordering Location</th>
                <th>IP</th>
                <th>OP</th>
                <th>Emergency</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              {% for i, (location, data) in visit_type_list %}
              <tr>
                <td>{{ i }}</td>
                <td>{{ location }}</td>
                <td>{{ data['IP'] }}</td>
                <td>{{ data['OP'] }}</td>
                <td>{{ data['Emergency'] }}</td>
                <td>{{ data['Total'] }}</td>
              </tr>
              {% endfor %}
              <tr class="total-row">
                <td colspan="2">Total</td>
                <td>{{ visit_type_totals['IP'] }}</td>
                <td>{{ visit_type_totals['OP'] }}</td>
                <td>{{ visit_type_totals['Emergency'] }}</td>
                <td>{{ visit_type_totals['Total'] }}</td>
              </tr>
            </tbody>
           
          </table>
          <button class="vis_button" id="ris-register-chart"> 
            Generate Visualization
          </button>
          <canvas id="risRegisterChart"></canvas>

          <h2>Modality Analysis</h2>
          <table>
            <thead>
              <tr>
                <th>Ordering Location</th>
                <th>XRAY</th>
                <th>CT Scan</th>
                <th>Ultra Sound</th>
                <th>MRI</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              {% for location, data in modality_results.items() %}
              <tr>
                <td>{{ location }}</td>
                <td>{{ data['XRAY'] }}</td>
                <td>{{ data['CT Scan'] }}</td>
                <td>{{ data['Ultra Sound'] }}</td>
                <td>{{ data['MRI'] }}</td>
                <td>{{ data['Total'] }}</td>
              </tr>
              {% endfor %}
              <tr class="total-row">
                <td>Total</td>
                <td>{{ modality_totals['XRAY'] }}</td>
                <td>{{ modality_totals['CT Scan'] }}</td>
                <td>{{ modality_totals['Ultra Sound'] }}</td>
                <td>{{ modality_totals['MRI'] }}</td>
                <td>{{ modality_totals['Total'] }}</td>
              </tr>
            </tbody>
            
          </table>
          <button class="vis_button" id="ris-modality-chart">
            Generate Visualization
          </button>
          <canvas id="risModalityChart"></canvas>

          <!-- Ris department category(eg:xray,ct scan) wise Required count comparison Section -->
          <h2 class="section-title">Ris sub department wise Report</h2>

          <div class="table-container" id="ris-subdepartment-table">
            <table>
              <thead>
                <tr>
                  <th>Department</th>
                  <th>Required Count</th>
                  <th>RIS Count</th>
                </tr>
              </thead>
              <tbody>
                {% for row in df_ris %}
                <tr>
                  <td>{{ row['Department'] }}</td>
                  <td>{{ row['Required Count'] }}</td>
                  <td>{{ row['RIS Count'] }}</td>
                </tr>
                {% endfor %}
              </tbody>
              
            </table>
            <button class="vis_button" id="ris-subDepartment-chart">
              Generate Visualization
            </button>
            <canvas id="risSubDepartmentChart"></canvas>
          </div>
          <!-- Ris category wise Section -->
          <div class="table-container risCategoryContainer">
            <h3 class="subsection-title">Category Wise Summary</h3>
            {{ summary_html_categories_ris|safe }}
            <button class="vis_button" id="ris-category-chart">
              Generate Visualization
            </button>
            <canvas id="risCategoryChart"></canvas>
          </div>
        </div>
        <button id="risDownloadBtn" class="btn">Download RIS Summary</button>
      </section> 

      <!-- Biopsy Section -->
      <section class="department-section" id="biopsy">
        <h2 class="section-title">Biopsy Count</h2>

        <div class="table-container biopsy-container">
          <table>
            <thead>
              <tr>
                <th>Sl. No</th>
                <th>Department</th>
                <th>Count</th>
              </tr>
            </thead>
            <tbody>
              {% for row in results_biopsy[:-1] %}
              <tr>
                <td>{{ row.sl_no }}</td>
                <td>{{ row.department }}</td>
                <td>{{ row.ip_count }}</td>
              </tr>
              {% endfor %}
              <tr class="total-row">
                <td>{{ results_biopsy[-1].sl_no }}</td>
                <td>{{ results_biopsy[-1].department }}</td>
                <td>{{ results_biopsy[-1].ip_count }}</td>
              </tr>
            </tbody>
          </table>
          <button class="vis_button" id="generate-chart" class="btn">
            Generate Visualization
          </button>
          <div>
            <canvas
              id="biopsyChart"
              class="piechart"
            ></canvas>
          </div>
        </div>
        <button id="biopsyDownload" class="btn">Download Biopsy Summary</button>
      </section>
    <!-- LIS Department Wise Section -->
    <section class="department-section" id="biopsy">
      <div class="container mt-5">
       
        <h1 class="text-center">Department Visit Report</h1>
        

        {% for department, data in all_results_lis.items() %}
        <div class="mb-5">
            <h2>{{ department }}</h2>
            <table class="table table-bordered table-hover">
                <thead>
                    <tr>
                        <th>Sl.No</th>
                        <th>Ordering Location</th>
                        <th>IP Required</th>
                        <th>IP</th>
                        <th>OP Required</th>
                        <th>OP</th>
                        
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in data.data %}
                    <tr>
                        <td>{{ row["Sl.No"] }}</td>
                        <td>{{ row["Ordering Location"] }}</td>
                        <td>{{row["IP Required"]}}</td>
                        <td>{{ row["IP"] }}</td>
                        <td>{{row["OP Required"]}}</td>
                        <td>{{ row["OP"] }}</td>
                        
                        <td>{{ row["Total"] }}</td>
                    </tr>
                    {% endfor %}
                    <tr>
                        <td></td>
                        <td><strong>Total</strong></td>
                        <td><strong>{{data.totals["IP Required"]}}</strong></td>
                        <td><strong>{{ data.totals["IP"] }}</strong></td>
                        <td><strong>{{data.totals["OP Required"]}}</strong></td>
                        <td><strong>{{ data.totals["OP"] }}</strong></td>
                        
                        <td><strong>{{ data.totals["Total"] }}</strong></td>
                    </tr>
                </tbody>
            </table>
           
        </div>
        {% endfor %}

        
    </div>
    <button id="lisDeptDownload" class="btn">Download LIS DEPT-WISE Summary</button>
    </section>
    </main>

    <footer>
      <p>&copy; 2025 SFON Technologies</p>
      <p>
        Built & Executed by Syed Mohd Ghouse, Mir Abdul Aziz Khan and Mohammed
        Irfan
      </p>
    </footer>

    <script>
          // Tab Navigation
          const tabButtons = document.querySelectorAll(".tab-button");
          const departments = document.querySelectorAll(".department-section");
          
         
          document.getElementById('risDownloadBtn').addEventListener('click', async () => {
    const { jsPDF } = window.jspdf;
    
    const pdf = new jsPDF('p', 'mm', 'a4');
    const options = { scale: 2 }; // Higher scale for better quality
    
    let visitTypeTable, modalityTable, subDepartmentTable, categoryTable;
    let visitTypeChart, modalityChart, subDepartmentChart, categoryChart;
    
    try {
        // Capture all tables
        visitTypeTable = await html2canvas(document.querySelector('#ris table:nth-of-type(1)'), options);
        modalityTable = await html2canvas(document.querySelector('#ris table:nth-of-type(2)'), options);
        subDepartmentTable = await html2canvas(document.querySelector('#ris-subdepartment-table table'), options);
        categoryTable = await html2canvas(document.querySelector('.risCategoryContainer'), options);
        
        // Capture all charts - with safety checks
        const visitTypeElement = document.getElementById('risRegisterChart');
        visitTypeChart = visitTypeElement && visitTypeElement.getContext ? 
            await html2canvas(visitTypeElement, options) : null;
            
        const modalityElement = document.getElementById('risModalityChart');
        modalityChart = modalityElement && modalityElement.getContext ? 
            await html2canvas(modalityElement, options) : null;
            
        const subDepartmentElement = document.getElementById('risSubDepartmentChart');
        subDepartmentChart = subDepartmentElement && subDepartmentElement.getContext ? 
            await html2canvas(subDepartmentElement, options) : null;
            
        const categoryElement = document.getElementById('risCategoryChart');
        // Only try to capture if the canvas is properly initialized
        if (categoryElement && categoryElement.getContext && categoryElement.style.display !== 'none') {
            try {
                categoryChart = await html2canvas(categoryElement, options);
            } catch (chartError) {
                console.warn("Could not capture category chart:", chartError);
                categoryChart = null;
            }
        } else {
            console.warn("Category chart element not ready for capture");
            categoryChart = null;
        }
    } catch (error) {
        console.error("Error capturing canvas: ", error);
        return;
    }
    
    // Validate captured tables (charts can be optional)
    if (!visitTypeTable || !modalityTable || !subDepartmentTable || !categoryTable) {
        console.error("One or more tables failed to render");
        return;
    }
    
    const pageWidth = pdf.internal.pageSize.getWidth();
    const imgWidth = pageWidth - 20; // Leaving 10mm margin on each side
    
    try {
        // Page 1: Visit Type Analysis
        pdf.text('RIS Visit Type Analysis', 10, 10);
        const visitTypeHeight = (visitTypeTable.height / visitTypeTable.width) * imgWidth;
        pdf.addImage(visitTypeTable.toDataURL('image/png'), 'PNG', 10, 20, imgWidth, visitTypeHeight);
        
        // Add visit type chart if it exists
        if (visitTypeChart) {
            const chartHeight = (visitTypeChart.height / visitTypeChart.width) * imgWidth;
            pdf.addImage(visitTypeChart.toDataURL('image/png'), 'PNG', 10, visitTypeHeight + 30, imgWidth, chartHeight);
        }
        
        // Page 2: Modality Analysis
        pdf.addPage();
        pdf.text('RIS Modality Analysis', 10, 10);
        const modalityHeight = (modalityTable.height / modalityTable.width) * imgWidth;
        pdf.addImage(modalityTable.toDataURL('image/png'), 'PNG', 10, 20, imgWidth, modalityHeight);
        
        if (modalityChart) {
            const chartHeight = (modalityChart.height / modalityChart.width) * imgWidth;
            pdf.addImage(modalityChart.toDataURL('image/png'), 'PNG', 10, modalityHeight + 30, imgWidth, chartHeight);
        }
        
        // Page 3: Sub Department Analysis
        pdf.addPage();
        pdf.text('RIS Sub Department Analysis', 10, 10);
        const subDeptHeight = (subDepartmentTable.height / subDepartmentTable.width) * imgWidth;
        pdf.addImage(subDepartmentTable.toDataURL('image/png'), 'PNG', 10, 20, imgWidth, subDeptHeight);
        
        if (subDepartmentChart) {
            const chartHeight = (subDepartmentChart.height / subDepartmentChart.width) * imgWidth;
            pdf.addImage(subDepartmentChart.toDataURL('image/png'), 'PNG', 10, subDeptHeight + 30, imgWidth, chartHeight);
        }
        
        // Page 4: Category Analysis
        pdf.addPage();
        pdf.text('RIS Category Analysis', 10, 10);
        const categoryHeight = (categoryTable.height / categoryTable.width) * imgWidth;
        pdf.addImage(categoryTable.toDataURL('image/png'), 'PNG', 10, 20, imgWidth, categoryHeight);
        
        // Only try to add category chart if it was successfully captured
        if (categoryChart) {
            const chartHeight = (categoryChart.height / categoryChart.width) * imgWidth;
            pdf.addImage(categoryChart.toDataURL('image/png'), 'PNG', 10, categoryHeight + 30, imgWidth, chartHeight);
        }
        
        pdf.save('RIS-summary.pdf');
    } catch (error) {
        console.error("Error generating PDF: ", error);
    }
});
        
//opd download
          document.getElementById('opdDownload').addEventListener('click', async () => {
            const { jsPDF } = window.jspdf;
        
            const pdf = new jsPDF('p', 'mm', 'a4'); // Create jsPDF instance
            const options = { scale: 2 }; // Higher scale improves quality
        
            let deptCanvas, categoryCanvas, opdVisCanvas, opdCatVisCanvas;
            try {
                // Capture department and category summaries
                deptCanvas = await html2canvas(document.querySelector('.opdContainer'), options);
                categoryCanvas = await html2canvas(document.querySelector('.opdCategoryContainer'), options);
        
                // Capture visualizations
                opdVisCanvas = await html2canvas(document.getElementById('deptChart'), options);
                opdCatVisCanvas = await html2canvas(document.getElementById('categoryChart'), options);
            } catch (error) {
                console.error("Error capturing canvas: ", error);
                return;
            }
        
            // Validate captured canvases
            if (!deptCanvas || !categoryCanvas || !opdVisCanvas || !opdCatVisCanvas) {
                console.error("One or more canvases failed to render");
                return;
            }
        
            const pageWidth = pdf.internal.pageSize.getWidth();
            const imgWidth = pageWidth - 20;
            
            try {
                const deptImgHeight = (deptCanvas.height / deptCanvas.width) * imgWidth;
                pdf.text('OPD Department Wise Summary', 10, 10);
                pdf.addImage(deptCanvas.toDataURL('image/png'), 'PNG', 10, 20, imgWidth, deptImgHeight);
        
                pdf.addPage();
                const deptVisImgHeight = (opdVisCanvas.height / opdVisCanvas.width) * imgWidth;
                pdf.text('OPD Department Visualization', 10, 10);
                pdf.addImage(opdVisCanvas.toDataURL('image/png'), 'PNG', 10, 20, imgWidth, deptVisImgHeight);

                pdf.addPage();
                const categoryImgHeight = (categoryCanvas.height / categoryCanvas.width) * imgWidth;
                pdf.text('OPD Category Wise Summary', 10, 10);
                pdf.addImage(categoryCanvas.toDataURL('image/png'), 'PNG', 10, 20, imgWidth, categoryImgHeight);
        
                
        
                pdf.addPage();
                const categoryVisImgHeight = (opdCatVisCanvas.height / opdCatVisCanvas.width) * imgWidth;
                pdf.text('OPD Category Visualization', 10, 10);
                pdf.addImage(opdCatVisCanvas.toDataURL('image/png'), 'PNG', 10, 20, imgWidth, categoryVisImgHeight);
        
                pdf.save('OPD-summary.pdf');
            } catch (error) {
                console.error("Error adding image to PDF: ", error);
            }
        });
        //ipd download
        document.getElementById('ipdDownload').addEventListener('click', async () => {
          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF('p', 'mm', 'a4'); // Create jsPDF instance
          const options = { scale: 2, useCORS: true, willReadFrequently: true };
      
          let ipdDeptCanvas, ipdVisCanvas;
          try {
              // Capture department and visualization sections
              const deptContainer = document.querySelector('.ipdContainer');
              const visDiv = document.querySelector('.vis-div'); 
              ipdDeptCanvas = await html2canvas(deptContainer, options);
              ipdVisCanvas = await html2canvas(visDiv, options);
              
          } catch (error) {
              console.error("Error capturing canvas: ", error);
              return;
          }
      
          if (!ipdDeptCanvas || !ipdVisCanvas) {
              console.error("One or more canvases failed to render");
              return;
          }
      
          const pageWidth = pdf.internal.pageSize.getWidth();
          const imgWidth = pageWidth - 20;
      
          try {
              const deptImgHeight = (ipdDeptCanvas.height / ipdDeptCanvas.width) * imgWidth;
              pdf.text('IPD Department Wise Summary', 10, 10);
              pdf.addImage(ipdDeptCanvas.toDataURL('image/png'), 'PNG', 10, 20, imgWidth, deptImgHeight);
      
              pdf.addPage();
              const deptVisImgHeight = (ipdVisCanvas.height / ipdVisCanvas.width) * imgWidth;
              pdf.text('IPD Department Visualization', 10, 10);
              pdf.addImage(ipdVisCanvas.toDataURL('image/png'), 'PNG', 10, 20, imgWidth, deptVisImgHeight);
      
              pdf.save('IPD-summary.pdf');
          } catch (error) {
              console.error("Error adding image to PDF: ", error);
          }
      });
      //Doctors download
      document.getElementById('doctorDownload').addEventListener('click', async () => {
        const { jsPDF } = window.jspdf;
          const pdf = new jsPDF('p', 'mm', 'a4');
        const deptContainer = document.querySelector('.doctor-section');
        const originalStyles = deptContainer.style.cssText;
        
        // Temporarily override styles
        deptContainer.style.animation = 'none';
        deptContainer.style.transform = 'none';
        
        const options = { scale: 2, useCORS: true, backgroundColor: null };
        
        try {
            drDeptCanvas = await html2canvas(deptContainer, options);
        } catch (error) {
            console.error("Error capturing canvas: ", error);
        }
        
        // Restore original styles
        deptContainer.style.cssText = originalStyles;
        
        // Save to PDF
        if (drDeptCanvas) {
            const pdf = new jsPDF('p', 'mm', 'a4');
            const pageWidth = pdf.internal.pageSize.getWidth();
            const imgWidth = pageWidth - 20;
            const imgHeight = (drDeptCanvas.height / drDeptCanvas.width) * imgWidth;
        
            
            pdf.addImage(drDeptCanvas.toDataURL('image/png'), 'PNG', 10, 20, imgWidth, imgHeight);
            pdf.save('Doctor-summary.pdf');
        }
        
      });
      document.getElementById('lisDownload').addEventListener('click', async () => {
        const { jsPDF } = window.jspdf;
    
        const pdf = new jsPDF('p', 'mm', 'a4'); // Create jsPDF instance
        const options = { scale: 2 }; // Higher scale improves quality
    
        let lisDataCanvas, lisOpCanvas, lisIpCanvas, lisCategoryCanvas, lisCategoryVisCanvas;
    
        try {
            // Capture different sections as canvases
            lisDataCanvas = await html2canvas(document.querySelector('.lis-container'), options);
            lisOpCanvas = await html2canvas(document.querySelector('.lisOp'), options);
            lisIpCanvas = await html2canvas(document.querySelector('.lisIp'), options);
            lisCategoryCanvas = await html2canvas(document.querySelector('.lis-category-container'), options);
            lisCategoryVisCanvas = await html2canvas(document.querySelector('.lis-category-vis'), options);
        } catch (error) {
            console.error("Error capturing canvas: ", error);
            return;
        }
    
        // Validate captured canvases
        if (!lisDataCanvas || !lisOpCanvas || !lisIpCanvas || !lisCategoryCanvas || !lisCategoryVisCanvas) {
            console.error("One or more canvases failed to render");
            return;
        }
    
        const pageWidth = pdf.internal.pageSize.getWidth();
        const imgWidth = pageWidth - 20;
    
        try {
            // Add LIS Data Summary
            const lisDataImgHeight = (lisDataCanvas.height / lisDataCanvas.width) * imgWidth;
            pdf.text('LIS Data Summary', 10, 10);
            pdf.addImage(lisDataCanvas.toDataURL('image/png'), 'PNG', 10, 20, imgWidth, lisDataImgHeight);
    
            // Add LIS OP Summary
            pdf.addPage();
            const lisOpImgHeight = (lisOpCanvas.height / lisOpCanvas.width) * imgWidth;
            pdf.text('LIS OP Summary', 10, 10);
            pdf.addImage(lisOpCanvas.toDataURL('image/png'), 'PNG', 10, 20, imgWidth, lisOpImgHeight);
    
            // Add LIS IP Summary
            pdf.addPage();
            const lisIpImgHeight = (lisIpCanvas.height / lisIpCanvas.width) * imgWidth;
            pdf.text('LIS IP Summary', 10, 10);
            pdf.addImage(lisIpCanvas.toDataURL('image/png'), 'PNG', 10, 20, imgWidth, lisIpImgHeight);
    
            // Add LIS Category Summary
            pdf.addPage();
            const lisCategoryImgHeight = (lisCategoryCanvas.height / lisCategoryCanvas.width) * imgWidth;
            pdf.text('LIS Category Summary', 10, 10);
            pdf.addImage(lisCategoryCanvas.toDataURL('image/png'), 'PNG', 10, 20, imgWidth, lisCategoryImgHeight);
    
            // Add LIS Category Visualization
            pdf.addPage();
            const lisCategoryVisImgHeight = (lisCategoryVisCanvas.height / lisCategoryVisCanvas.width) * imgWidth;
            pdf.text('LIS Category Visualization', 10, 10);
            pdf.addImage(lisCategoryVisCanvas.toDataURL('image/png'), 'PNG', 10, 20, imgWidth, lisCategoryVisImgHeight);
    
            // Save the PDF
            pdf.save('LIS-summary.pdf');
        } catch (error) {
            console.error("Error adding image to PDF: ", error);
        }
    });
    document.getElementById('otDownload').addEventListener('click', async () => {
      const { jsPDF } = window.jspdf;
  
      const pdf = new jsPDF('p', 'mm', 'a4'); // Create jsPDF instance
      const options = { scale: 2 }; // Higher scale improves quality
  
      let minorOtCanvas, minorOtChartCanvas, majorOtCanvas, majorOtChartCanvas;
  
      try {
          // Capture different sections as canvases
          minorOtCanvas = await html2canvas(document.querySelector('.minor-ot-container'), options);
          minorOtChartCanvas = await html2canvas(document.getElementById('minorOtChart'), options);
          majorOtCanvas = await html2canvas(document.querySelector('.major-ot-container'), options);
          majorOtChartCanvas = await html2canvas(document.getElementById('majorOtChart'), options);
      } catch (error) {
          console.error("Error capturing canvas: ", error);
          return;
      }
  
      // Validate captured canvases
      if (!minorOtCanvas || !minorOtChartCanvas || !majorOtCanvas || !majorOtChartCanvas) {
          console.error("One or more canvases failed to render");
          return;
      }
  
      const pageWidth = pdf.internal.pageSize.getWidth();
      const imgWidth = pageWidth - 20;
  
      try {
          // Add Minor OT Table
          const minorOtImgHeight = (minorOtCanvas.height / minorOtCanvas.width) * imgWidth;
          pdf.text('Minor OT Summary', 10, 10);
          pdf.addImage(minorOtCanvas.toDataURL('image/png'), 'PNG', 10, 20, imgWidth, minorOtImgHeight);
  
          // Add Minor OT Chart
          pdf.addPage();
          const minorOtChartImgHeight = (minorOtChartCanvas.height / minorOtChartCanvas.width) * imgWidth;
          pdf.text('Minor OT Chart', 10, 10);
          pdf.addImage(minorOtChartCanvas.toDataURL('image/png'), 'PNG', 10, 20, imgWidth, minorOtChartImgHeight);
  
          // Add Major OT Table
          pdf.addPage();
          const majorOtImgHeight = (majorOtCanvas.height / majorOtCanvas.width) * imgWidth;
          pdf.text('Major OT Summary', 10, 10);
          pdf.addImage(majorOtCanvas.toDataURL('image/png'), 'PNG', 10, 20, imgWidth, majorOtImgHeight);
  
          // Add Major OT Chart
          pdf.addPage();
          const majorOtChartImgHeight = (majorOtChartCanvas.height / majorOtChartCanvas.width) * imgWidth;
          pdf.text('Major OT Chart', 10, 10);
          pdf.addImage(majorOtChartCanvas.toDataURL('image/png'), 'PNG', 10, 20, imgWidth, majorOtChartImgHeight);
  
          // Save the PDF
          pdf.save('OT-summary.pdf');
      } catch (error) {
          console.error("Error adding image to PDF: ", error);
      }
  });
  document.getElementById('biopsyDownload').addEventListener('click', async () => {
    const { jsPDF } = window.jspdf;

    const pdf = new jsPDF('p', 'mm', 'a4'); // Create jsPDF instance
    const options = { scale: 2 }; // Higher scale improves quality

    let biopsyTableCanvas;
    try {
        // Capture biopsy table and chart as canvases
        biopsyTableCanvas = await html2canvas(document.querySelector('.biopsy-container'), options);
    } catch (error) {
        console.error("Error capturing canvas: ", error);
        return;
    }

    // Validate captured canvases
    if (!biopsyTableCanvas ) {
        console.error("One or more canvases failed to render");
        return;
    }

    const pageWidth = pdf.internal.pageSize.getWidth();
    const imgWidth = pageWidth - 20;

    try {
        // Add Biopsy Table
        const biopsyTableImgHeight = (biopsyTableCanvas.height / biopsyTableCanvas.width) * imgWidth;
        pdf.text('Biopsy Count Summary', 10, 10);
        pdf.addImage(biopsyTableCanvas.toDataURL('image/png'), 'PNG', 10, 20, imgWidth, biopsyTableImgHeight);


        // Save the PDF
        pdf.save('Biopsy-summary.pdf');
    } catch (error) {
        console.error("Error adding image to PDF: ", error);
    }
  });

          tabButtons.forEach((button, index) => {
                    button.addEventListener("click", () => {
                      // Update active tab
                      tabButtons.forEach((btn) => btn.classList.remove("active"));
                      button.classList.add("active");

                      // Show selected department
                      departments.forEach((dept, deptIndex) => {
                        if (index === deptIndex) {
                          dept.style.display = "block";
                          // Trigger animation
                          dept.style.opacity = "0";
                          dept.style.transform = "translateY(20px)";
                          setTimeout(() => {
                            dept.style.opacity = "1";
                            dept.style.transform = "translateY(0)";
                          }, 50);
                        } else {
                          dept.style.display = "none";
                        }
                      });
                    });
                  });

                  // Initialize the first tab as visible
                  departments.forEach((dept, index) => {
                    dept.style.display = index === 0 ? "block" : "none";
                  });
        
    



    //  RIS Charts
    // Visit Type Chart
document.getElementById('ris-register-chart').addEventListener('click', function() {
    const ctx = document.getElementById('risRegisterChart');
    const locations = [];
    const ipData = [];
    const opData = [];
    const emergencyData = [];

    // Extract data from table
    const table = document.querySelector('#ris table:first-of-type');
    const rows = table.querySelectorAll('tbody tr:not(.total-row)');
    
    rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        if(cells.length > 0) {
            locations.push(cells[1].textContent);
            ipData.push(parseInt(cells[2].textContent));
            opData.push(parseInt(cells[3].textContent));
            emergencyData.push(parseInt(cells[4].textContent));
        }
    });

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: locations,
            datasets: [
                {
                    label: 'IP',
                    data: ipData,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                },
                {
                    label: 'OP',
                    data: opData,
                    backgroundColor: 'rgba(255, 159, 64, 0.2)',
                    borderColor: 'rgba(255, 159, 64, 1)',
                    borderWidth: 1
                },
                {
                    label: 'Emergency',
                    data: emergencyData,
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                }
            ]
        },
        options: {
            plugins: {
                legend: {
                    labels: {
                        font: {
                            size: 16,
                            weight: 'bold',
                        },
                        color: '#333',
                    }
                },
                datalabels: {
                    color: '#000',
                    anchor: 'end',
                    align: 'top',
                    font: {
                        size: 14,
                        weight: 'bold',
                    },
                    formatter: function(value) {
                        return value;
                    }
                }
            },
            scales: {
                x: {
                    ticks: {
                        font: {
                            size: 14,
                            weight: 'bold'
                        },
                        color: '#333'
                    }
                },
                y: {
                    ticks: {
                        font: {
                            size: 14,
                            weight: 'bold'
                        },
                        color: '#333'
                    },
                    beginAtZero: true
                }
            }
        },
        plugins: [ChartDataLabels]
    });
});

// Modality Analysis Chart
document.getElementById('ris-modality-chart').addEventListener('click', function() {
    const ctx = document.getElementById('risModalityChart');
    const locations = [];
    const xrayData = [];
    const ctData = [];
    const ultraSoundData = [];
    const mriData = [];

    // Extract data from table
    const table = document.querySelector('#ris table:nth-of-type(2)');
    const rows = table.querySelectorAll('tbody tr:not(.total-row)');
    
    rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        if(cells.length > 0) {
            locations.push(cells[0].textContent);
            xrayData.push(parseInt(cells[1].textContent));
            ctData.push(parseInt(cells[2].textContent));
            ultraSoundData.push(parseInt(cells[3].textContent));
            mriData.push(parseInt(cells[4].textContent));
        }
    });

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: locations,
            datasets: [
                {
                    label: 'XRAY',
                    data: xrayData,
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                },
                {
                    label: 'CT Scan',
                    data: ctData,
                    backgroundColor: 'rgba(153, 102, 255, 0.2)',
                    borderColor: 'rgba(153, 102, 255, 1)',
                    borderWidth: 1
                },
                {
                    label: 'Ultra Sound',
                    data: ultraSoundData,
                    backgroundColor: 'rgba(255, 206, 86, 0.2)',
                    borderColor: 'rgba(255, 206, 86, 1)',
                    borderWidth: 1
                },
                {
                    label: 'MRI',
                    data: mriData,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }
            ]
        },
        options: {
            plugins: {
                legend: {
                    labels: {
                        font: {
                            size: 16,
                            weight: 'bold',
                        },
                        color: '#333',
                    }
                },
                datalabels: {
                    color: '#000',
                    anchor: 'end',
                    align: 'top',
                    font: {
                        size: 14,
                        weight: 'bold',
                    },
                    formatter: function(value) {
                        return value;
                    }
                }
            },
            scales: {
                x: {
                    ticks: {
                        font: {
                            size: 14,
                            weight: 'bold'
                        },
                        color: '#333'
                    }
                },
                y: {
                    ticks: {
                        font: {
                            size: 14,
                            weight: 'bold'
                        },
                        color: '#333'
                    },
                    beginAtZero: true
                }
            }
        },
        plugins: [ChartDataLabels]
    });
});

// RIS Sub Department Chart
document.getElementById('ris-subDepartment-chart').addEventListener('click', function() {
    const ctx = document.getElementById('risSubDepartmentChart');
    const departments = [];
    const requiredData = [];
    const risData = [];

    // Extract data from table
    const table = document.querySelector('#ris-subdepartment-table');
    const rows = table.querySelectorAll('tbody tr');
    
    rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        if(cells.length > 0) {
            departments.push(cells[0].textContent);
            requiredData.push(parseInt(cells[1].textContent));
            risData.push(parseInt(cells[2].textContent));
        }
    });

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: departments,
            datasets: [
                {
                    label: 'Required Count',
                    data: requiredData,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                },
                {
                    label: 'RIS Count',
                    data: risData,
                    backgroundColor: 'rgba(85, 223, 117, 0.6)',
                    borderColor: 'rgba(3, 32, 7, 0.35)',
                    borderWidth: 1
                }
            ]
        },
        options: {
            plugins: {
                legend: {
                    labels: {
                        font: {
                            size: 16,
                            weight: 'bold',
                        },
                        color: '#333',
                    }
                },
                datalabels: {
                    color: '#000',
                    anchor: 'end',
                    align: 'top',
                    font: {
                        size: 14,
                        weight: 'bold',
                    },
                    formatter: function(value) {
                        return value;
                    }
                }
            },
            scales: {
                x: {
                    ticks: {
                        font: {
                            size: 14,
                            weight: 'bold'
                        },
                        color: '#333'
                    }
                },
                y: {
                    ticks: {
                        font: {
                            size: 14,
                            weight: 'bold'
                        },
                        color: '#333'
                    },
                    beginAtZero: true
                }
            }
        },
        plugins: [ChartDataLabels]
    });
});



document.getElementById('ris-category-chart').addEventListener('click', function() {
    // Get the canvas and set its size
    const canvas = document.getElementById('risCategoryChart');
    canvas.style.height = '400px';
    
    // Clear any existing charts
    if (window.categoryCharts) {
        window.categoryCharts.forEach(chart => chart.destroy());
    }
    window.categoryCharts = [];

    // Get data from the categories table
    const categoryTable = document.querySelector('.risCategoryContainer table');
    const rows = Array.from(categoryTable.querySelectorAll('tbody tr'));
    
    // Filter out the total row (usually the last row)
    const dataRows = rows.filter(row => {
        const firstCell = row.querySelector('td');
        return firstCell && !firstCell.textContent.trim().toLowerCase().includes('total');
    });
    
    const categories = [];
    const opCounts = [];
    const ipCounts = [];
    const backgroundColors = [
        'rgba(255, 99, 132, 0.7)',
        'rgba(54, 162, 235, 0.7)',
        'rgba(255, 206, 86, 0.7)',
        'rgba(75, 192, 192, 0.7)',
        'rgba(153, 102, 255, 0.7)',
        'rgba(255, 159, 64, 0.7)',
        'rgba(99, 255, 132, 0.7)',
        'rgba(162, 54, 235, 0.7)'
    ];
    
    dataRows.forEach(row => {
        const cells = row.querySelectorAll('td');
        if(cells.length > 0) {
            categories.push(cells[0].textContent.trim());
            opCounts.push(parseInt(cells[1].textContent));
            ipCounts.push(parseInt(cells[2].textContent));
        }
    });

    // Create a container div within the canvas parent
    const containerDiv = document.createElement('div');
containerDiv.style.display = 'flex';
containerDiv.style.justifyContent = 'flex-start';

containerDiv.style.width = '380px';
containerDiv.style.marginTop = '20px';
containerDiv.style.paddingLeft = '0';
containerDiv.style.paddingRight = '80px';
    
    // Create two new canvas elements
    const opCanvas = document.createElement('canvas');
    const ipCanvas = document.createElement('canvas');
    
    // Set size and style for canvases
    opCanvas.style.width = '180px'; // Reduce width
opCanvas.style.height = '250px'; // Reduce height
ipCanvas.style.width = '180px';
ipCanvas.style.height = '250px';
    
    // Add canvases to container
    containerDiv.appendChild(opCanvas);
    containerDiv.appendChild(ipCanvas);
    
    // Replace the original canvas with our container
    canvas.parentNode.replaceChild(containerDiv, canvas);

    // Create OP Distribution Chart
    const opChart = new Chart(opCanvas, {
        type: 'pie',
        data: {
            labels: categories,
            datasets: [{
                data: opCounts,
                backgroundColor: backgroundColors.slice(0, categories.length),
                borderColor: backgroundColors.slice(0, categories.length).map(color => color.replace('0.7', '1')),
                borderWidth: 1
            }]
        },
        options: {
            plugins: {
                title: {
                    display: true,
                    text: 'OP Patient Distribution by Category',
                    font: {
                        size: 16,
                        weight: 'bold'
                    }
                },
                legend: {
                    position: 'right',
                    labels: {
                        font: {
                            size: 12,
                            weight: 'bold'
                        }
                    }
                },
                datalabels: {
                    color: '#fff',
                    font: {
                        weight: 'bold',
                        size: 12
                    },
                    formatter: function(value, context) {
                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                        const percentage = ((value / total) * 100).toFixed(1);
                        return `${value}`;
                    }
                }
            },
            responsive: true,
            maintainAspectRatio: false
        },
        plugins: [ChartDataLabels]
    });

    // Create IP Distribution Chart
    const ipChart = new Chart(ipCanvas, {
        type: 'pie',
        data: {
            labels: categories,
            datasets: [{
                data: ipCounts,
                backgroundColor: backgroundColors.slice(0, categories.length),
                borderColor: backgroundColors.slice(0, categories.length).map(color => color.replace('0.7', '1')),
                borderWidth: 1
            }]
        },
        options: {
            plugins: {
                title: {
                    display: true,
                    text: 'IP Patient Distribution by Category',
                    font: {
                        size: 16,
                        weight: 'bold'
                    }
                },
                legend: {
                    position: 'right',
                    labels: {
                        font: {
                            size: 12,
                            weight: 'bold'
                        }
                    }
                },
                datalabels: {
                    color: '#fff',
                    font: {
                        weight: 'bold',
                        size: 12
                    },
                    formatter: function(value, context) {
                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                        const percentage = ((value / total) * 100).toFixed(1);
                        return `${value}`;
                    }
                }
            },
            responsive: true,
            maintainAspectRatio: false
        },
        plugins: [ChartDataLabels]
    });

    // Store charts for cleanup on next click
    window.categoryCharts = [opChart, ipChart];
});       

<!--Opd charts-->
                document.getElementById('generate-dept-chart').addEventListener('click', function() {
                    const labels = {{ departments_json | safe }};
                    const data = {{ daily_opd_count_json | safe }};
                    const required = {{ opd_required_json | safe }};
        
                    const deptChart = document.getElementById('deptChart');
                    new Chart(deptChart, {
                      type: 'bar',
                      data: {
                          labels: labels,
                          datasets: [
                          {
                              label: 'OPD Required',
                              data: required,
                              backgroundColor: 'rgba(75, 192, 192, 0.2)',
                              borderColor: 'rgba(75, 192, 192, 1)',
                              borderWidth: 1
                          },
                          {
                              label: 'OPD Count',
                              data: data,
                              backgroundColor: 'rgba(85, 223, 117, 0.6)',
                              borderColor: 'rgba(3, 32, 7, 0.35)',
                              borderWidth: 1
                          }
                          ]
                      },
                      options: {
                          plugins: {
                            legend: {
                              labels: {
                                  font: {
                                      size: 16, // Font size for legend
                                      weight: 'bold', // Bold legend text
                                  },
                                  color: '#333', // Color of legend text
                              }
                            },
                            datalabels: {
                              color: '#000', // Color of the data labels
                              anchor: 'end', // Positioning of the label
                              align: 'top', // Alignment of the label
                              font: {
                                  size: 14, // Font size for data labels
                                  weight: 'bold', // Bold data labels
                              },
                              formatter: function (value) {
                                  return value; // Display the value
                              }
                            }
                          },
                          scales: {
                            x: {
                            ticks: {
                                font: {
                                    size: 14, // Font size for X-axis labels
                                    weight: 'bold' // Bold X-axis labels
                                },
                                color: '#333' // Color of X-axis labels
                            }
                            },
                            y: {
                            ticks: {
                                font: {
                                    size: 14, // Font size for Y-axis labels
                                    weight: 'bold' // Bold Y-axis labels
                                },
                                color: '#333' // Color of Y-axis labels
                            },
                            beginAtZero: true
                            }
                          }
                      },
                      plugins: [ChartDataLabels] // Register the plugin
                    });
        
                  });
          <!--Opd category charts-->
                                        document.getElementById('generate-category-chart').addEventListener('click', function() {
                                            const labels = {{ categories_json | safe }};
                                            const data = {{ patient_counts_json | safe }};

                                            const categoryChart = document.getElementById('categoryChart')
                                            new Chart(categoryChart, {
                                                type: 'pie',
                                                data: {
                                                    labels: labels,
                                                    datasets: [{
                                                        data: data,
                                                        backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0']
                                                    }]
                                                },options: {
                                                  responsive: false,
                                                  maintainAspectRatio: false,
                                                  plugins: {
                                                      legend: {
                                                        position: 'right',
                                                        labels: {
                                                          font: {
                                                              size: 14, // Font size for the legend
                                                              weight: 'bold', // Optional: Make the legend text bold
                                                          },
                                                          color: '#000', // Legend text color
                                                      }
                                                      },datalabels: {
                                                        color: '#000',
                                                        font: {
                                                          size: 14, // Set the font size (in pixels)
                                                          weight: 'bold', // Optional: Make the text bold
                                                      },  // Color of the text
                                                        anchor: 'top', // Positioning of the label
                                                        align: 'top', // Alignment of the label
                                                        formatter: function(value) {
                                                            return value; // Display the value
                                                        }
                                                    }
                                                  }
                                              },plugins: [ChartDataLabels]
                                            });
                                        });

          
          
                                        
          <!--IPD charts-->
                                        const departmentNames = {{ department_names | tojson }};
                                        const ipd80Percent = {{ ipd80Percent | tojson }};
                                        const totalCounts = {{ totalCounts | tojson }};
                                        const PatientGeneral = {{ PatientGeneral | tojson }};
                                        const General = {{ General | tojson }};

                                        document.getElementById('generate--chart-ipd').addEventListener('click', function () {
                                            const ctx = document.getElementById('ipd-chart').getContext('2d');
                                            
                                            // Create the chart using Chart.js
                                            new Chart(ctx, {
                                                type: 'bar',
                                                data: {
                                                    labels: departmentNames, // X-axis labels (Departments)
                                                    datasets: [
                                                        {
                                                            label: 'IPD 80%',
                                                            data: ipd80Percent,
                                                            backgroundColor: 'rgba(75, 192, 192, 0.6)',
                                                            borderColor: 'rgba(75, 192, 192, 1)',
                                                            borderWidth: 1,
                                                        },
                                                        {
                                                            label: 'Patient General',
                                                            data: PatientGeneral,
                                                            backgroundColor: 'rgba(255, 99, 132, 0.6)',
                                                            stack: 'TotalCount'
                                                          },
                                                          {
                                                            label: 'General+Aarogyasri+ESH',
                                                            data: General,
                                                            backgroundColor: 'rgba(255, 206, 86, 0.6)',
                                                            stack: 'TotalCount'
                                                          },

                                                        ]
                                                      },

                                                options: {
                                                  plugins: {
                                                    legend: {
                                                        labels: {
                                                            font: {
                                                                size: 16, // Font size for legend
                                                                weight: 'bold', // Bold legend text
                                                            },
                                                            color: '#333', // Color of legend text
                                                        }
                                                    },
                                                    datalabels: {
                                                        color: '#000', // Color of the data labels
                                                        anchor: 'end', // Positioning of the label
                                                        align: 'top', // Alignment of the label
                                                        font: {
                                                            size: 14, // Font size for data labels
                                                            weight: 'bold', // Bold data labels
                                                        },
                                                        formatter: function (value) {
                                                            return value; // Display the value
                                                        }
                                                    }
                                                },
                                                    scales: {
                                                      x: {
                                                          ticks: {
                                                              font: {
                                                                  size: 14, // Font size for X-axis labels
                                                                  weight: 'bold' // Bold X-axis labels
                                                              },
                                                              color: '#333' // Color of X-axis labels
                                                          }
                                                      },
                                                      y: {
                                                          ticks: {
                                                              font: {
                                                                  size: 14, // Font size for Y-axis labels
                                                                  weight: 'bold' // Bold Y-axis labels
                                                              },
                                                              color: '#333' // Color of Y-axis labels
                                                          },
                                                          beginAtZero: true
                                                      }
                                                  }
                                              },
                                            });
                                        });



          <!--Lis charts-->
                                        document.getElementById('generate--chart-lis').addEventListener('click', function(){

                                         const subDepartments = {{ results_lis|map(attribute='sub_department')| list| tojson }};
                                         const blank1 = {{ results_lis|map(attribute='blank1')| list | tojson }};
                                         const blank2 = {{ results_lis|map(attribute='blank2')| list |tojson }};
                                         const opCount = {{ results_lis|map(attribute='op_count')| list| tojson }};
                                         const ipCount = {{ results_lis|map(attribute='ip_count')| list |tojson }};

                                         // Chart 1: Blank1 vs OP Count
                                         const ctx1 = document.getElementById('chart1').getContext('2d');
                                         new Chart(ctx1, {
                                           type: 'bar',
                                           data: {
                                             labels: subDepartments,
                                             datasets: [
                                               {
                                                 label: 'Services Required from OP',
                                                 data: blank1,
                                                 backgroundColor: 'rgba(54, 162, 235, 0.6)',
                                                 borderColor: 'rgba(54, 162, 235, 1)',
                                                 borderWidth: 1,
                                               },
                                               {
                                                 label: 'OP Count',
                                                 data: opCount,
                                                 backgroundColor: 'rgba(255, 99, 132, 0.6)',
                                                 borderColor: 'rgba(255, 99, 132, 1)',
                                                 borderWidth: 1,
                                               }
                                             ]
                                           },
                                           options: {
                                            plugins: {
                                                legend: {
                                                    labels: {
                                                        font: {
                                                            size: 16, // Font size for legend
                                                            weight: 'bold', // Bold legend text
                                                        },
                                                        color: '#333', // Color of legend text
                                                    }
                                                },
                                                datalabels: {
                                                    color: '#000', // Color of the data labels
                                                    anchor: 'end', // Positioning of the label
                                                    align: 'top', // Alignment of the label
                                                    font: {
                                                        size: 14, // Font size for data labels
                                                        weight: 'bold', // Bold data labels
                                                    },
                                                    formatter: function (value) {
                                                        return value; // Display the value
                                                    }
                                                }
                                            },
                                            scales: {
                                              x: {
                                                  ticks: {
                                                      font: {
                                                          size: 14, // Font size for X-axis labels
                                                          weight: 'bold' // Bold X-axis labels
                                                      },
                                                      color: '#333' // Color of X-axis labels
                                                  }
                                              },
                                              y: {
                                                  ticks: {
                                                      font: {
                                                          size: 14, // Font size for Y-axis labels
                                                          weight: 'bold' // Bold Y-axis labels
                                                      },
                                                      color: '#333' // Color of Y-axis labels
                                                  },
                                                  beginAtZero: true
                                              }
                                          }
                                      },
                                        plugins: [ChartDataLabels] // Register the plugin
                                    });

                                         // Chart 2: Blank2 vs IP Count
                                         const ctx2 = document.getElementById('chart2').getContext('2d');
                                         new Chart(ctx2, {
                                           type: 'bar',
                                           data: {
                                             labels: subDepartments,
                                             datasets: [
                                               {
                                                 label: 'Services Required from IP',
                                                 data: blank2,
                                                 backgroundColor: 'rgba(75, 192, 192, 0.6)',
                                                 borderColor: 'rgba(75, 192, 192, 1)',
                                                 borderWidth: 1,
                                               },
                                               {
                                                 label: 'IP Count',
                                                 data: ipCount,
                                                 backgroundColor: 'rgba(153, 102, 255, 0.6)',
                                                 borderColor: 'rgba(153, 102, 255, 1)',
                                                 borderWidth: 1,
                                               }
                                             ]
                                           },
                                           options: {
                                            plugins: {
                                                legend: {
                                                    labels: {
                                                        font: {
                                                            size: 16, // Font size for legend
                                                            weight: 'bold', // Bold legend text
                                                        },
                                                        color: '#333', // Color of legend text
                                                    }
                                                },
                                                datalabels: {
                                                    color: '#000', // Color of the data labels
                                                    anchor: 'end', // Positioning of the label
                                                    align: 'top', // Alignment of the label
                                                    font: {
                                                        size: 14, // Font size for data labels
                                                        weight: 'bold', // Bold data labels
                                                    },
                                                    formatter: function (value) {
                                                        return value; // Display the value
                                                    }
                                                }
                                            },
                                            scales: {
                                              x: {
                                                  ticks: {
                                                      font: {
                                                          size: 14, // Font size for X-axis labels
                                                          weight: 'bold' // Bold X-axis labels
                                                      },
                                                      color: '#333' // Color of X-axis labels
                                                  }
                                              },
                                              y: {
                                                  ticks: {
                                                      font: {
                                                          size: 14, // Font size for Y-axis labels
                                                          weight: 'bold' // Bold Y-axis labels
                                                      },
                                                      color: '#333' // Color of Y-axis labels
                                                  },
                                                  beginAtZero: true
                                              }
                                          }
                                      },
                                        plugins: [ChartDataLabels] // Register the plugin
                                    });

                                   });
          <!--LIS category charts-->
                                   document.getElementById('generate-category-chart-lis').addEventListener('click', function() {
                                       const labels = {{ lisCategory_json | safe }};
                                       const opd_data = {{ opd_patient_count_json | safe }};
                                       const ipd_data = {{ ipd_patient_count_json | safe }};

                                       const categoryChart = document.getElementById('lisOpdCategoryChart')
                                       new Chart(categoryChart, {
                                           type: 'pie',
                                           data: {
                                               labels: labels,
                                               datasets: [{
                                                   data: opd_data,
                                                   backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0']
                                               }]
                                           },options: {
                                            responsive: false,
                                            maintainAspectRatio: false,
                                            plugins: {
                                                legend: {
                                                  position: 'right',
                                                  labels: {
                                                    font: {
                                                        size: 14, // Font size for the legend
                                                        weight: 'bold', // Optional: Make the legend text bold
                                                    },
                                                    color: '#000', // Legend text color
                                                }
                                                },datalabels: {
                                                  color: '#000',
                                                  font: {
                                                    size: 14, // Set the font size (in pixels)
                                                    weight: 'bold', // Optional: Make the text bold
                                                },  // Color of the text
                                                  anchor: 'top', // Positioning of the label
                                                  align: 'top', // Alignment of the label
                                                  formatter: function(value) {
                                                      return value; // Display the value
                                                  }
                                              }
                                            }
                                        },plugins: [ChartDataLabels]
                                      });
                                       const categoryChart1 = document.getElementById('lisIpdCategoryChart')
                                       new Chart(categoryChart1, {
                                           type: 'pie',
                                           data: {
                                               labels: labels,
                                               datasets: [{
                                                   data: ipd_data,
                                                   backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0']
                                               }]
                                           },options: {
                                            responsive: false,
                                            maintainAspectRatio: false,
                                            plugins: {
                                                legend: {
                                                  position: 'right',
                                                  labels: {
                                                    font: {
                                                        size: 14, // Font size for the legend
                                                        weight: 'bold', // Optional: Make the legend text bold
                                                    },
                                                    color: '#000', // Legend text color
                                                }
                                                },datalabels: {
                                                  color: '#000',
                                                  font: {
                                                    size: 14, // Set the font size (in pixels)
                                                    weight: 'bold', // Optional: Make the text bold
                                                },  // Color of the text
                                                  anchor: 'top', // Positioning of the label
                                                  align: 'top', // Alignment of the label
                                                  formatter: function(value) {
                                                      return value; // Display the value
                                                  }
                                              }
                                            }
                                        },plugins: [ChartDataLabels]
                                      });
                                   });
          <!--Operation Report-->
                                   document.getElementById('generate-otChart').addEventListener('click', function() {
                                   const minorCtx = document.getElementById('minorOtChart').getContext('2d');
                                   const majorCtx = document.getElementById('majorOtChart').getContext('2d');

                                   // Get dynamic data from the backend (Minor OT)
                                   const minorDepartments = {{ results_ot[1]|map(attribute='department')|list|tojson }};
                                   const minorSurgeriesRequired = {{ results_ot[1]|map(attribute='blank1')|list|tojson }};
                                   const minorPatientGeneral = {{ results_ot[1]|map(attribute='minor_patient_general')|list|tojson }};
                                   const minorGeneral = {{ results_ot[1]|map(attribute='minor_gen')|list|tojson }};
                                   const minorAarogyasri = {{ results_ot[1]|map(attribute='minor_arg')|list|tojson }};
                                   const minorESH = {{ results_ot[1]|map(attribute='minor_esh')|list|tojson }};

                                   // Create Minor OT chart
                                   new Chart(minorCtx, {
                                     type: 'bar',
                                     data: {
                                       labels: minorDepartments,
                                       datasets: [
                                         // Minor Surgeries Required - Standalone
                                         {
                                           label: 'Minor Surgeries Required',
                                           data: minorSurgeriesRequired,
                                           backgroundColor: 'rgba(54, 162, 235, 0.6)',
                                           borderColor: 'rgba(54, 162, 235, 1)',
                                           borderWidth: 1
                                         },
                                         // Stacked Total Count Segregation
                                         {
                                           label: 'Patient General',
                                           data: minorPatientGeneral,
                                           backgroundColor: 'rgba(255, 99, 133, 0.97)',
                                           stack: 'TotalCount'
                                         },
                                         {
                                           label: 'General',
                                           data: minorGeneral,
                                           backgroundColor: 'rgba(255, 206, 86, 0.6)',
                                           stack: 'TotalCount'
                                         },
                                         {
                                           label: 'Aarogyasri',
                                           data: minorAarogyasri,
                                           backgroundColor: 'rgba(153, 102, 255, 0.6)',
                                           stack: 'TotalCount'
                                         },
                                         {
                                           label: 'ESH',
                                           data: minorESH,
                                           backgroundColor: 'rgba(255, 159, 64, 0.6)',
                                           stack: 'TotalCount'
                                         }
                                       ]
                                     },
                                     options: {
                                      plugins: {
                                        legend: {
                                            labels: {
                                                font: {
                                                    size: 16, // Font size for legend
                                                    weight: 'bold', // Bold legend text
                                                },
                                                color: '#333', // Color of legend text
                                            }
                                        },
                                        datalabels: {
                                            color: '#000', // Color of the data labels
                                            anchor: 'end', // Positioning of the label
                                            align: 'top', // Alignment of the label
                                            font: {
                                                size: 14, // Font size for data labels
                                                weight: 'bold', // Bold data labels
                                            },
                                            formatter: function (value) {
                                                return value; // Display the value
                                            }
                                        }
                                    },
                                        scales: {
                                          x: {
                                              ticks: {
                                                  font: {
                                                      size: 14, // Font size for X-axis labels
                                                      weight: 'bold' // Bold X-axis labels
                                                  },
                                                  color: '#333' // Color of X-axis labels
                                              }
                                          },
                                          y: {
                                              ticks: {
                                                  font: {
                                                      size: 14, // Font size for Y-axis labels
                                                      weight: 'bold' // Bold Y-axis labels
                                                  },
                                                  color: '#333' // Color of Y-axis labels
                                              },
                                              beginAtZero: true
                                          }
                                      }
                                  },
                                });
                                   

                                   // Create Major OT chart (unchanged)
                                   const majorDepartments = {{ results_ot[0]|map(attribute='department')|list|tojson }};
                                   const majorSurgeriesRequired = {{ results_ot[0]|map(attribute='blank2')|list|tojson }};
                                   const majorPatientGeneral = {{ results_ot[0]|map(attribute='major_patient_general')|list|tojson }};
                                   const majorGeneral = {{ results_ot[0]|map(attribute='major_gen')|list|tojson }};
                                   const majorAarogyasri = {{ results_ot[0]|map(attribute='major_arg')|list|tojson }};
                                   const majorESH = {{ results_ot[0]|map(attribute='major_esh')|list|tojson }};

                                   new Chart(majorCtx, {
                                     type: 'bar',
                                     data: {
                                       labels: majorDepartments,
                                       datasets: [
                                         {
                                           label: 'Major Surgeries Required',
                                           data: majorSurgeriesRequired,
                                           backgroundColor: 'rgba(54, 162, 235, 0.6)',
                                           borderColor: 'rgba(54, 162, 235, 1)',
                                           borderWidth: 1
                                         },
                                         // Stacked Total Count Segregation
                                         {
                                           label: 'Patient General',
                                           data: majorPatientGeneral,
                                           backgroundColor: 'rgba(255, 99, 133, 0.94)',
                                           stack: 'TotalCount'
                                         },
                                         {
                                           label: 'General',
                                           data: majorGeneral,
                                           backgroundColor: 'rgba(255, 206, 86, 0.6)',
                                           stack: 'TotalCount'
                                         },
                                         {
                                           label: 'Aarogyasri',
                                           data: majorAarogyasri,
                                           backgroundColor: 'rgba(153, 102, 255, 0.6)',
                                           stack: 'TotalCount'
                                         },
                                         {
                                           label: 'ESH',
                                           data: majorESH,
                                           backgroundColor: 'rgba(255, 159, 64, 0.6)',
                                           stack: 'TotalCount'
                                         }
                                       ]
                                     },
                                     options: {
                                      plugins: {
                                        legend: {
                                            labels: {
                                                font: {
                                                    size: 16, // Font size for legend
                                                    weight: 'bold', // Bold legend text
                                                },
                                                color: '#333', // Color of legend text
                                            }
                                        },
                                        datalabels: {
                                            color: '#000', // Color of the data labels
                                            anchor: 'end', // Positioning of the label
                                            align: 'top', // Alignment of the label
                                            font: {
                                                size: 14, // Font size for data labels
                                                weight: 'bold', // Bold data labels
                                            },
                                            formatter: function (value) {
                                                return value; // Display the value
                                            }
                                        }
                                    },
                                        scales: {
                                          x: {
                                              ticks: {
                                                  font: {
                                                      size: 14, // Font size for X-axis labels
                                                      weight: 'bold' // Bold X-axis labels
                                                  },
                                                  color: '#333' // Color of X-axis labels
                                              }
                                          },
                                          y: {
                                              ticks: {
                                                  font: {
                                                      size: 14, // Font size for Y-axis labels
                                                      weight: 'bold' // Bold Y-axis labels
                                                  },
                                                  color: '#333' // Color of Y-axis labels
                                              },
                                              beginAtZero: true
                                          }
                                      }
                                  },
                                });
                                   });
          <!--Biopsy Report-->
                              document.getElementById('generate-chart').addEventListener('click', function () {

                                   const ctx = document.getElementById('biopsyChart').getContext('2d');

                                   // Extracting data for the pie chart
                                   const departments = {{ results_biopsy[:-1]|map(attribute='department')|list|tojson }};
                                   const counts = {{ results_biopsy[:-1]|map(attribute='ip_count')|list|tojson }};

                                   // Creating the pie chart
                                   new Chart(ctx, {
                                       type: 'pie',
                                       data: {
                                           labels: departments,
                                           datasets: [{
                                               label: 'IP Count',
                                               data: counts,
                                               backgroundColor: [
                                                   'rgba(255, 99, 132, 0.2)',
                                                   'rgba(54, 162, 235, 0.2)',
                                                   'rgba(255, 206, 86, 0.2)',
                                                   'rgba(75, 192, 192, 0.2)',
                                                   'rgba(153, 102, 255, 0.2)'
                                               ],
                                               borderColor: [
                                                   'rgba(255, 99, 132, 1)',
                                                   'rgba(54, 162, 235, 1)',
                                                   'rgba(255, 206, 86, 1)',
                                                   'rgba(75, 192, 192, 1)',
                                                   'rgba(153, 102, 255, 1)'
                                               ],
                                               borderWidth: 1
                                           }]
                                       },
                                       options: {
                                        responsive: false,
                                        maintainAspectRatio: false,
                                        plugins: {
                                            legend: {
                                              position: 'right',
                                              labels: {
                                                font: {
                                                    size: 14, // Font size for the legend
                                                    weight: 'bold', // Optional: Make the legend text bold
                                                },
                                                color: '#000', // Legend text color
                                            }
                                            },datalabels: {
                                              color: '#000',
                                              font: {
                                                size: 14, // Set the font size (in pixels)
                                                weight: 'bold', // Optional: Make the text bold
                                            },  // Color of the text
                                              anchor: 'top', // Positioning of the label
                                              align: 'top', // Alignment of the label
                                              formatter: function(value) {
                                                  return value; // Display the value
                                              }
                                          }
                                        }
                                    },plugins: [ChartDataLabels]
                                  });
                                });
    </script>
  </body>
</html>
